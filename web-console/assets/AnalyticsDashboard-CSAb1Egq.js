import{c as w,r as d,i as C,j as e,C as l,e as i,B as p,R as g,Y as A,a as o,b as x,F as T,Q as S,d as y}from"./index-DLzrVyEL.js";import{S as r}from"./skeleton-C3jo3W2d.js";import{H as k}from"./HelpTip-Bf0ngYP4.js";import{u as E}from"./usePageTitle-BWQ1x_eW.js";import{C as D}from"./circle-alert-ChFoNBvB.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=w("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function O(){E("Analytics");const[t,h]=d.useState(null),[N,j]=d.useState(!0),[u,f]=d.useState(null),c=d.useCallback(async()=>{j(!0),f(null);try{const s=await C("get_usage_stats");h(s)}catch(s){h(null),f(`Failed to load analytics: ${String(s)}`)}finally{j(!1)}},[]);d.useEffect(()=>{c()},[c]),d.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&c()};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[c]);const m=t?Object.entries(t.actionsByType).sort((s,a)=>a[1]-s[1]).slice(0,10):[],v=m.length>0?Math.max(m[0][1],1):1,n=t?Object.entries(t.actionsByDay).sort((s,a)=>s[0].localeCompare(a[0])).slice(-14):[],b=n.length>0?Math.max(...n.map(([,s])=>s),1):1;return N?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-8 w-32"}),e.jsx(r,{className:"h-4 w-48"})]})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(s=>e.jsx(l,{children:e.jsxs(i,{className:"p-6 space-y-3",children:[e.jsx(r,{className:"h-3 w-20"}),e.jsx(r,{className:"h-7 w-16"}),e.jsx(r,{className:"h-3 w-28"})]})},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2].map(s=>e.jsx(l,{children:e.jsxs(i,{className:"p-6 space-y-3",children:[e.jsx(r,{className:"h-5 w-28"}),e.jsx(r,{className:"h-3 w-40"}),e.jsx(r,{className:"h-48 w-full"})]})},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:["Analytics",e.jsx(k,{text:"See how your agent has been used â€” total actions, errors, and activity over time. All data is stored locally in your audit log."})]}),e.jsx("p",{className:"text-muted-foreground",children:"Usage metrics from audit log"})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:c,"aria-label":"Refresh analytics",children:[e.jsx(g,{className:"mr-2 h-4 w-4"})," Refresh"]})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-destructive/20 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[e.jsx(A,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"flex-1",children:u}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(g,{className:"mr-2 h-3 w-3"})," Retry"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total Actions"}),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((t==null?void 0:t.totalActions)??0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All-time audit entries"})]})]}),e.jsxs(l,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Errors"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:((t==null?void 0:t.errorCount)??0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Entries containing errors"})]})]}),e.jsxs(l,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Action Types"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Distinct action categories"})]})]}),e.jsxs(l,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Active Days"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Days with activity"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(x,{className:"text-lg",children:"Top Actions"}),e.jsx(y,{children:"Most frequent action types"})]}),e.jsx(i,{children:m.length>0?e.jsx("div",{className:"space-y-2",role:"list","aria-label":"Top actions by frequency",children:m.map(([s,a])=>e.jsxs("div",{className:"space-y-1",role:"listitem",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-mono text-xs",children:s}),e.jsx("span",{className:"text-muted-foreground",children:a})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${a/v*100}%`}})})]},s))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No action data yet"})})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(x,{className:"text-lg",children:"Activity Over Time"}),e.jsx(y,{children:"Actions per day (last 14 days)"})]}),e.jsx(i,{children:n.length>0?e.jsx("div",{className:"flex items-end gap-1 h-48",role:"img","aria-label":`Activity chart showing ${n.length} days of data`,children:n.map(([s,a])=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-full rounded-t bg-primary min-h-[2px]",style:{height:`${a/b*160}px`},title:`${s}: ${a} actions`,"aria-hidden":"true"}),e.jsx("span",{className:"text-[10px] text-muted-foreground rotate-[-45deg] origin-top-left whitespace-nowrap",children:s.slice(5)})]},s))}):e.jsx("div",{className:"flex h-48 items-center justify-center rounded-lg border border-dashed text-muted-foreground",children:"No daily data yet"})})]})]})]})}export{O as default};
