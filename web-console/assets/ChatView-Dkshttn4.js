const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C5fSXSG5.js","assets/index-DLzrVyEL.js","assets/index-Di2Zhpwl.css"])))=>i.map(i=>d[i]);
import{c as Z,j as e,h as _,y as M,r as o,_ as re,B as x,Z as W,u as q,$ as oe,a0 as G,z as Y,a1 as X,a2 as le,C as ie,a as ce,b as de,D as me,e as ue,Y as he,f as xe,a3 as z,g as fe}from"./index-DLzrVyEL.js";import{S as ge,a as pe,b as ye,c as je,d as be}from"./select-Bf3NEO-Y.js";import{u as we}from"./useAgent-CUNFZjw0.js";import{U as Ne}from"./user-Bq0WeS-k.js";import{T as Se}from"./textarea-Cg5T9mcn.js";import{g as ve}from"./models-BN2rvPIS.js";import{u as Ce}from"./usePageTitle-BWQ1x_eW.js";import{S as ke}from"./search-DRTgMfl0.js";import{P as Ee}from"./pencil-CJ-valFp.js";import{T as _e}from"./trash-2-hOfGscB6.js";import{R as Ie}from"./rocket-D-37-1MK.js";import"./index-BmrRr2YK.js";import"./index-C-bnBz93.js";import"./check-BnfHjeKt.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Z("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Z("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Te=o.lazy(()=>re(()=>import("./index-C5fSXSG5.js"),__vite__mapDeps([0,1,2]))),De=/^https?:/i,Ae={a:({href:r,children:s,...d})=>{const m=r&&De.test(r);return e.jsx("a",{...d,href:m?r:void 0,target:"_blank",rel:"noopener noreferrer",onClick:m?void 0:l=>l.preventDefault(),children:s})}};function Me({message:r}){const s=r.role==="agent",d=r.role==="system";return e.jsxs("div",{className:M("flex gap-3",s?"flex-row":"flex-row-reverse"),children:[e.jsx("div",{className:M("flex h-8 w-8 shrink-0 items-center justify-center rounded-full",s?"bg-primary/20 text-primary":"bg-secondary text-secondary-foreground"),children:s?e.jsx(_,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"})}),e.jsxs("div",{className:M("max-w-[70%] rounded-lg px-4 py-2 text-sm",s?"bg-muted":"bg-primary text-primary-foreground",d&&"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20"),children:[s?e.jsx("div",{className:"prose prose-sm prose-invert max-w-none [&_pre]:overflow-x-auto [&_pre]:rounded-md [&_pre]:bg-black/20 [&_pre]:p-3 [&_code]:rounded [&_code]:bg-black/20 [&_code]:px-1 [&_code]:py-0.5 [&_code]:text-xs [&_p]:my-1 [&_ul]:my-1 [&_ol]:my-1 [&_li]:my-0.5 [&_h1]:text-base [&_h2]:text-sm [&_h3]:text-sm [&_h1]:font-bold [&_h2]:font-semibold [&_h3]:font-medium [&_a]:text-primary [&_a]:underline",children:e.jsx(o.Suspense,{fallback:e.jsx("p",{children:r.content}),children:e.jsx(Te,{disallowedElements:["script","iframe","object","embed","form","input","style"],unwrapDisallowed:!0,components:Ae,children:r.content})})}):e.jsx("p",{className:"whitespace-pre-wrap",children:r.content}),e.jsx("span",{className:"mt-1 block text-xs opacity-50",children:new Date(r.timestamp).toLocaleTimeString()})]})]})}const P=32e3,ze=3e4;function Pe({onSend:r,disabled:s,pendingResponse:d}){const m=s||d,[l,g]=o.useState(""),S=o.useRef(null),p=()=>{var i;l.trim()&&(r(l.trim()),g(""),(i=S.current)==null||i.focus())},R=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),p())},y=l.length>=ze,j=l.length>=P;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Se,{ref:S,value:l,onChange:i=>g(i.target.value.slice(0,P)),onKeyDown:R,placeholder:s?"Agents offline...":d?"Waiting for response...":"Type a message... (Enter to send, Shift+Enter for newline)",disabled:m,className:"min-h-[44px] max-h-32 resize-none",rows:1}),e.jsx(x,{onClick:p,disabled:m||!l.trim(),size:"icon",className:"shrink-0","aria-label":"Send message",title:s?"Start agents to send messages":d?"Waiting for response":l.trim()?void 0:"Type a message first",children:e.jsx(Le,{className:"h-4 w-4"})})]}),y&&e.jsxs("p",{className:`text-[10px] text-right tabular-nums ${j?"text-destructive":"text-amber-500"}`,children:[l.length.toLocaleString()," / ",P.toLocaleString()]})]})}function Oe(){return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary/20 text-primary",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-1 rounded-lg bg-muted px-4 py-2",children:[e.jsx("span",{className:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground/50 [animation-delay:0ms]"}),e.jsx("span",{className:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground/50 [animation-delay:150ms]"}),e.jsx("span",{className:"h-2 w-2 animate-bounce rounded-full bg-muted-foreground/50 [animation-delay:300ms]"})]})]})}const I=32e3,$e=[8203,8204,8205,8206,8207,8288,8289,8290,8291,8292,65279,173,847,1564,6158,8232,8233,8234,8235,8236,8237,8238,8294,8295,8296,8297,65529,65530,65531],Ue=new RegExp("["+$e.map(r=>String.fromCodePoint(r)).join("")+"]","g");function He(r){let s=r.replace(Ue,"");return s.length>I&&(s=s.slice(0,I)),s}const Fe=12e4;function Ke(r){const s=((r==null?void 0:r.personalityFile)??"").toLowerCase();return s.includes("code")?["Review a piece of code for me","Help me debug an issue","Explain a programming concept","Write a function that..."]:s.includes("research")?["Summarize a topic for me","Compare two options side by side","Find the key facts about...","What are the pros and cons of...?"]:s.includes("creative")?["Write me a short story","Help me brainstorm ideas","Draft a catchy headline","Rewrite this in a different tone"]:["What can you help me with?","Help me brainstorm ideas","Explain how you work","Write me something creative"]}function nt(){Ce("Chat");const{sessions:r,activeSessionId:s,pendingResponseFor:d,addSession:m,setActiveSession:l,addMessage:g,removeSession:S,renameSession:p,clearSession:R,setSessionAgent:y,setPendingResponseFor:j,setStreamingMessageId:i,addSystemMessage:O}=W(),v=q(t=>t.gatewayConnected),J=q(t=>t.setMilestone),{agents:C}=we(),$=o.useRef(null),k=o.useRef(null),U=o.useRef(s),[Q,E]=o.useState(null),[b,H]=o.useState(""),[L,ee]=o.useState(""),[F,T]=o.useState(!1);o.useEffect(()=>{U.current=s},[s]);const a=r.find(t=>t.id===s),u=o.useMemo(()=>C.filter(t=>t.enabled),[C]),f=u.find(t=>t.id===(a==null?void 0:a.agentId)),h=d===s,w=o.useCallback(()=>{k.current&&(clearTimeout(k.current),k.current=null)},[]);o.useEffect(()=>{h||w()},[h,w]),o.useEffect(()=>()=>w(),[w]);const K=()=>{const t=u[0],n={id:crypto.randomUUID(),title:`Chat ${r.length+1}`,messages:[],agentId:t==null?void 0:t.id,createdAt:new Date().toISOString()};m(n)},te=t=>{if(s){y(s,t);const n=u.find(c=>c.id===t);n&&z(`Switched to ${n.name}`,"default")}},B=t=>{const n=He(t);if(!s||!n.trim()||!(a!=null&&a.agentId))return;t.length>I&&z(`Message truncated to ${I.toLocaleString()} characters`,"default");const c={id:crypto.randomUUID(),role:"user",content:n,timestamp:new Date().toISOString()};g(s,c),j(s),J("firstChat");const N=`agent:${a.agentId}:${s}`;if(!fe.request("chat.send",{sessionKey:N,message:n,idempotencyKey:c.id})){O(s,"Your agents aren't running. Go to Dashboard and click Start Agents."),j(null),i(null);return}w();const A=s;k.current=setTimeout(()=>{const{pendingResponseFor:ne}=W.getState();ne===A&&U.current===A&&(O(A,"Try again, or check the Dashboard to make sure your agents are running."),j(null),i(null))},Fe)},se=()=>{if(!a)return;const t=a.messages.map(D=>`**${D.role}:** ${D.content}`).join(`

`),n=new Blob([t],{type:"text/markdown"}),c=URL.createObjectURL(n),N=document.createElement("a");N.href=c,N.download=`${a.title}.md`,N.click(),URL.revokeObjectURL(c),z(`Exported "${a.title}.md"`,"success")};o.useEffect(()=>{var t;(t=$.current)==null||t.scrollIntoView({behavior:"smooth"})},[a==null?void 0:a.messages.length,h]),o.useEffect(()=>{if(r.length===0&&u.length>0&&K(),u.length>0)for(const t of r)t.agentId||y(t.id,u[0].id)},[r.length,m,y,C.length]);const ae=(t,n)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),l(n))},V=e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:K,size:"sm",className:"w-full",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," New Chat"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-2 top-2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(G,{value:L,onChange:t=>ee(t.target.value),placeholder:"Search chats...",className:"h-8 pl-7 text-xs"})]}),e.jsx(Y,{className:"h-[calc(100%-5.5rem)]",children:e.jsx("div",{className:"space-y-1",children:r.filter(t=>{if(!L.trim())return!0;const n=L.toLowerCase();return t.title.toLowerCase().includes(n)?!0:t.messages.some(c=>c.content.toLowerCase().includes(n))}).map(t=>e.jsxs("div",{role:"button",tabIndex:0,className:`flex items-center justify-between rounded-md px-3 py-2 text-sm cursor-pointer transition-colors ${t.id===s?"bg-accent text-accent-foreground":"hover:bg-muted"}`,onClick:()=>{l(t.id),T(!1)},onKeyDown:n=>ae(n,t.id),children:[Q===t.id?e.jsx(G,{value:b,onChange:n=>H(n.target.value),onBlur:()=>{b.trim()&&p(t.id,b.trim()),E(null)},onKeyDown:n=>{n.key==="Enter"?(b.trim()&&p(t.id,b.trim()),E(null)):n.key==="Escape"&&E(null)},className:"h-6 text-xs px-1",autoFocus:!0,onClick:n=>n.stopPropagation()}):e.jsx("span",{className:"truncate",children:t.title}),e.jsxs("div",{className:"flex shrink-0",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"Rename chat",title:"Rename",onClick:n=>{n.stopPropagation(),E(t.id),H(t.title)},children:e.jsx(Ee,{className:"h-3 w-3"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"Delete chat",title:"Delete",onClick:n=>{n.stopPropagation();const c={...t,messages:[...t.messages]};S(t.id),X(`Deleted "${t.title}"`,()=>m(c))},children:e.jsx(_e,{className:"h-3 w-3"})})]})]},t.id))})})]});return e.jsxs("div",{className:"flex h-[calc(100vh-8rem)] gap-4",children:[e.jsx("div",{className:"hidden md:flex w-64 flex-col space-y-2",children:V}),e.jsx(x,{variant:"outline",size:"icon",className:"md:hidden absolute top-20 left-2 z-10","aria-label":"Toggle chat list",onClick:()=>T(!F),children:e.jsx(le,{className:"h-4 w-4"})}),F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden fixed inset-0 z-10 bg-black/20",onClick:()=>T(!1)}),e.jsx("div",{className:"md:hidden absolute top-32 left-2 z-20 w-64 space-y-2 rounded-lg border bg-background p-3 shadow-lg",children:V})]}),e.jsxs(ie,{className:"flex flex-1 flex-col",children:[e.jsxs(ce,{className:"flex-row items-center justify-between gap-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"text-lg",children:(a==null?void 0:a.title)??"Chat"}),f&&e.jsx("span",{className:"rounded-full bg-muted px-2 py-0.5 text-xs text-muted-foreground",children:ve(f.model)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ge,{value:(a==null?void 0:a.agentId)??"",onValueChange:te,children:[e.jsx(pe,{className:"h-8 w-48",children:e.jsx(ye,{placeholder:"Select agent..."})}),e.jsx(je,{children:u.map(t=>e.jsx(be,{value:t.id,children:t.name},t.id))})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>{if(!s||!a)return;const t=[...a.messages];R(s),X("Chat cleared",()=>{for(const n of t)g(s,n)})},title:"Clear chat","aria-label":"Clear chat",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:se,title:"Export chat","aria-label":"Export chat",children:e.jsx(me,{className:"h-4 w-4"})})]})]}),e.jsxs(ue,{className:"flex flex-1 flex-col p-0",children:[!v&&e.jsxs("div",{className:"mx-4 mb-2 flex items-center gap-2 rounded-md border border-yellow-500/20 bg-yellow-500/10 px-3 py-2 text-sm text-yellow-400",children:[e.jsx(he,{className:"h-4 w-4 shrink-0"}),"Your agents are offline â€” go to Dashboard to start them"]}),u.length===0&&C.length===0&&e.jsxs("div",{className:"mx-4 mb-2 flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4",children:e.jsx(Ie,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Create your first agent"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"You need at least one agent before you can chat. Head to the Agents page to create one."}),e.jsxs(xe,{to:"/agents",className:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors",children:[e.jsx(_,{className:"h-4 w-4"})," Go to Agents"]})]}),e.jsx(Y,{className:"flex-1 px-4",children:e.jsxs("div",{className:"space-y-4 py-4","aria-live":"polite","aria-busy":h,children:[a&&a.messages.length===0&&!h&&f&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 mb-4",children:e.jsx(_,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-1",children:f.name}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:[f.name," is ready to assist you."]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Try one of these to get started:"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 w-full max-w-md",children:Ke(f).map(t=>e.jsx("button",{type:"button",className:"rounded-lg border px-3 py-2 text-sm text-left hover:bg-muted transition-colors",onClick:()=>B(t),disabled:!v,children:t},t))})]}),a==null?void 0:a.messages.map(t=>e.jsx(Me,{message:t},t.id)),h&&e.jsx(Oe,{}),e.jsx("div",{ref:$})]})}),e.jsxs("div",{className:"border-t p-4",children:[e.jsx(Pe,{onSend:B,disabled:!v||!(a!=null&&a.agentId),pendingResponse:h}),!(a!=null&&a.agentId)&&v&&e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Select an agent to start chatting"})]})]})]})]})}export{nt as default};
