import{u as Z,r as t,aO as R,al as ee,j as e,Y as se,C as p,a as g,b as f,e as j,aP as te,aQ as ae,a0 as d,B as re,X as ne,m as ie}from"./index-DLzrVyEL.js";import{S as ce}from"./switch-CtqUxp-4.js";import{L as c}from"./label-N6WvVUTh.js";import{u as le}from"./useConfig-DHY6Oysh.js";import{g as oe,w as de}from"./config-DtO68tKR.js";import{H as A}from"./HelpTip-Bf0ngYP4.js";import{C as ue}from"./ConfirmDialog-BoXiTj0F.js";import{u as me}from"./usePageTitle-BWQ1x_eW.js";import{R as he}from"./rotate-ccw-zsPzpsnb.js";import"./index-C-bnBz93.js";const xe="1.1.1";function ke(){me("Settings");const w=ie()==="web",{darkMode:I,toggleDarkMode:z}=Z(),{config:a,reload:T}=le(),[L,Q]=t.useState("~/.openclaw"),[u,y]=t.useState(R),[N,C]=t.useState("~/agent-mvp"),[S,k]=t.useState("10000"),[m,b]=t.useState("5433"),[h,E]=t.useState("6380"),[n,l]=t.useState(!1),[X,U]=t.useState(!1),[J,M]=t.useState(!1),[O,H]=t.useState(null);t.useEffect(()=>{oe().then(s=>{Q(s),H(null)}).catch(s=>{H(s instanceof Error?s.message:String(s))})},[]),t.useEffect(()=>{var s,r,W,_,$,B,F,K,V,q;a&&(y(((r=(s=a.settings)==null?void 0:s.gateway)==null?void 0:r.wsUrl)??R),C(((_=(W=a.settings)==null?void 0:W.desktop)==null?void 0:_.dockerComposePath)??"~/agent-mvp"),k(String(((B=($=a.settings)==null?void 0:$.desktop)==null?void 0:B.healthCheckIntervalMs)??1e4)),b(String(((K=(F=a.settings)==null?void 0:F.services)==null?void 0:K.postgresPort)??5433)),E(String(((q=(V=a.settings)==null?void 0:V.services)==null?void 0:q.redisPort)??6380)))},[a]);const[Y,G]=t.useState(null),o=(()=>{if(!u.trim())return"URL is required";try{const s=new URL(u);return["ws:","wss:","http:","https:"].includes(s.protocol)?null:"URL must use ws, wss, http, or https protocol"}catch{return"Invalid URL format"}})(),P=parseInt(m,10),D=parseInt(h,10),i=m.trim()&&(isNaN(P)||P<1024||P>65535)?"Database port must be a number between 1024 and 65535":h.trim()&&(isNaN(D)||D<1024||D>65535)?"Cache port must be a number between 1024 and 65535":null,v=t.useCallback(async()=>{if(!a||i||o)return;G(null);const s={...a,settings:{...a.settings,gateway:{...a.settings.gateway,wsUrl:u},services:{...a.settings.services,postgresPort:parseInt(m,10)||5433,redisPort:parseInt(h,10)||6380},desktop:{...a.settings.desktop,dockerComposePath:N,healthCheckIntervalMs:parseInt(S,10)||1e4}}};try{await de(s),w||await ee().catch(()=>{}),await T(),l(!1),U(!0),setTimeout(()=>U(!1),2e3)}catch(r){G(`Failed to save: ${String(r)}`)}},[a,i,o,u,m,h,N,S,T]),x=t.useRef(null);return t.useEffect(()=>{if(!(!n||i||o))return x.current&&clearTimeout(x.current),x.current=setTimeout(v,2e3),()=>{x.current&&clearTimeout(x.current)}},[n,i,o,v]),t.useEffect(()=>{if(!n)return;const s=r=>{r.preventDefault()};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[n]),t.useEffect(()=>{const s=r=>{(r.metaKey||r.ctrlKey)&&r.key==="s"&&(r.preventDefault(),n&&!i&&!o&&v())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[n,i,v]),e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:["Settings",e.jsx(A,{text:"Most settings work automatically. Only change these if support asks you to."})]}),e.jsx("p",{className:"text-muted-foreground",children:"Application preferences"})]}),n&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Auto-saving..."}),X&&!n&&e.jsx("span",{className:"text-xs text-green-500",children:"Saved"}),Y&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-destructive",children:[e.jsx(se,{className:"h-4 w-4"}),Y]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-lg",children:"Appearance"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[I?e.jsx(te,{className:"h-4 w-4"}):e.jsx(ae,{className:"h-4 w-4"}),e.jsx(c,{children:"Dark Mode"})]}),e.jsx(ce,{checked:I,onCheckedChange:z})]})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-lg",children:"Paths"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Agentic Console Config Directory"}),e.jsx(d,{value:O?`Error: ${O}`:L,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Vault Directory"}),e.jsx(d,{value:L.replace(/\.openclaw$/,".openclaw-desktop"),disabled:!0})]}),!w&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"flex items-center gap-2",children:["Agent Engine Files ",e.jsx(A,{text:"The folder where your agent engine files are stored. Only change this if support asks you to."})]}),e.jsx(d,{value:N,onChange:s=>{C(s.target.value),l(!0)}})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-lg",children:"Connection"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"flex items-center gap-2",children:["Agent Engine Address ",e.jsx(A,{text:"The network address your agents use to communicate. You shouldn't need to change this."})]}),e.jsx(d,{value:u,onChange:s=>{y(s.target.value),l(!0)}}),n&&o&&e.jsx("p",{className:"text-xs text-destructive",children:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Health Check Interval (ms)"}),e.jsx(d,{type:"number",value:S,onChange:s=>{k(s.target.value),l(!0)}})]})]})]}),!w&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-lg",children:"Service Ports"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Database Port"}),e.jsx(d,{type:"number",value:m,onChange:s=>{b(s.target.value),l(!0)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Cache Port"}),e.jsx(d,{type:"number",value:h,onChange:s=>{E(s.target.value),l(!0)}})]}),i&&e.jsx("p",{className:"text-sm text-destructive",children:i})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(re,{variant:"outline",size:"sm",onClick:()=>M(!0),children:[e.jsx(he,{className:"mr-2 h-4 w-4"})," Reset to Defaults"]})}),e.jsx(ue,{open:J,onOpenChange:M,title:"Reset to Defaults",description:"This will restore all connection and service port settings to their default values. Your appearance preferences will not change.",confirmLabel:"Reset",destructive:!0,onConfirm:()=>{y(R),C("~/agent-mvp"),k("10000"),b("5433"),E("6380"),l(!0)}}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsxs(f,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ne,{className:"h-5 w-5"})," About"]})}),e.jsxs(j,{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Agentic Console"})," v",xe]}),e.jsx("p",{children:"Privacy-first desktop platform for building and managing AI agents locally."}),e.jsx("p",{children:"No telemetry. No analytics. Everything local."})]})]})]})}export{ke as default};
