import{c as G,r as s,ad as U,ae as W,af as J,ag as Q,ah as X,ai as ee,aj as D,j as e,a4 as O,ak as te,B as n,$ as P,a5 as T,a7 as L,a8 as $,a9 as K,a0 as se,aa as z,Y as F,C as ae,a as re,E as le,b as ne,d as ie,e as ce,K as _,m as w,al as b,a3 as k}from"./index-DLzrVyEL.js";import{L as N}from"./label-N6WvVUTh.js";import{S as H}from"./SecureInput-BOCeOhgm.js";import{S as oe,a as de,b as ue,c as he,d as i}from"./select-Bf3NEO-Y.js";import{H as me}from"./HelpTip-Bf0ngYP4.js";import{C as xe}from"./ConfirmDialog-BoXiTj0F.js";import{u as pe}from"./usePageTitle-BWQ1x_eW.js";import{T as je}from"./trash-2-hOfGscB6.js";import"./eye-D6E-mqI1.js";import"./index-BmrRr2YK.js";import"./index-C-bnBz93.js";import"./check-BnfHjeKt.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=G("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);function ve(){const[x,u]=s.useState([]),[p,j]=s.useState(!1),[g,r]=s.useState(null),l=s.useCallback(async()=>{j(!0),r(null);try{const a=await U();u(a)}catch(a){u([]),r(a instanceof Error?a.message:String(a))}finally{j(!1)}},[]),c=s.useCallback(async a=>{await W(a),await l()},[l]),v=s.useCallback(async a=>{await J(a),await l()},[l]);return s.useEffect(()=>{l()},[l]),{entries:x,loading:p,error:g,store:c,remove:v,reload:l,storeSecret:D,readSecret:ee,unlockVault:X,vaultExists:Q}}function Ve(){pe("Credentials");const x=w()==="web",{entries:u,store:p,remove:j,error:g}=ve(),[r,l]=s.useState(""),[c,v]=s.useState(""),[a,A]=s.useState(""),[M,S]=s.useState(!1),[o,E]=s.useState(null),[f,C]=s.useState(""),[Y,y]=s.useState(!1),[R,h]=s.useState(null),[d,V]=s.useState(null),I=r&&!/^[A-Za-z_][A-Za-z0-9_]*$/.test(r)?"Key must be a valid env var name (letters, digits, underscores)":null,Z=async()=>{if(!r||!c||I)return;if(!a.trim()){h("Secret value cannot be empty");return}h(null);const t={key:r,provider:c,createdAt:new Date().toISOString(),lastRotated:null};try{await D(r,a),await p(t),w()!=="web"&&await b().catch(()=>{}),k(`Stored ${r}`,"success"),l(""),v(""),A(""),S(!1)}catch(m){h(`Failed to store credential: ${String(m)}`)}},B=async()=>{if(!(!o||!f)){h(null);try{await D(o.key,f);const t={...o,lastRotated:new Date().toISOString()};await p(t),w()!=="web"&&await b().catch(()=>{}),C(""),E(null),y(!1)}catch(t){h(`Failed to rotate secret: ${String(t)}`)}}},q=t=>{E(t),C(""),y(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:["Credential Vault",e.jsx(me,{text:"Store your API keys and bot tokens securely. Everything is encrypted on your machine with your master password. Nothing is sent to the cloud."})]}),e.jsx("p",{className:"text-muted-foreground",children:x?"Credentials are stored in the agent engine's environment":"Password-protected local credential storage"})]}),e.jsxs(O,{open:M,onOpenChange:S,children:[e.jsx(te,{asChild:!0,children:e.jsxs(n,{size:"sm",children:[e.jsx(P,{className:"mr-2 h-4 w-4"})," Add Credential"]})}),e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx($,{children:"Add Credential"}),e.jsx(K,{children:"Store a new API key in the local vault"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Key Name"}),e.jsx(se,{value:r,onChange:t=>l(t.target.value.toUpperCase().replace(/[^A-Z0-9_]/g,"_")),placeholder:"e.g., ANTHROPIC_API_KEY",maxLength:64})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Provider"}),e.jsxs(oe,{value:c,onValueChange:v,children:[e.jsx(de,{children:e.jsx(ue,{placeholder:"Select provider"})}),e.jsxs(he,{children:[e.jsx(i,{value:"anthropic",children:"Anthropic"}),e.jsx(i,{value:"xai",children:"xAI"}),e.jsx(i,{value:"openai",children:"OpenAI"}),e.jsx(i,{value:"telegram",children:"Telegram"}),e.jsx(i,{value:"slack",children:"Slack"}),e.jsx(i,{value:"discord",children:"Discord"}),e.jsx(i,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Secret Value"}),e.jsx(H,{value:a,onChange:A,placeholder:"Enter secret value"})]})]}),e.jsx(z,{children:e.jsx(n,{onClick:Z,disabled:!r||!c||!a.trim()||!!I,children:"Store in Vault"})})]})]})]}),R&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-destructive/20 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[e.jsx(F,{className:"h-4 w-4 shrink-0"}),R]}),e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),e.jsx(ne,{className:"text-lg",children:"Stored Credentials"})]}),e.jsx(ie,{children:"Values stored locally, protected by master password."})]}),e.jsx(ce,{children:g&&!x?e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-destructive/20 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[e.jsx(F,{className:"h-4 w-4 shrink-0"}),"Could not load credentials: ",g]}):u.length>0?e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm font-medium",children:t.key}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.provider," | Added ",new Date(t.createdAt).toLocaleDateString(),t.lastRotated&&` | Rotated ${new Date(t.lastRotated).toLocaleDateString()}`]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"Rotate secret",onClick:()=>q(t),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive","aria-label":"Delete credential",onClick:()=>V(t),children:e.jsx(je,{className:"h-4 w-4"})})]})]},t.key))}):e.jsxs("div",{className:"flex flex-col items-center py-8",children:[e.jsx(_,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No credentials stored yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 text-center max-w-md",children:"Add API keys to power your agents. You'll need at least one model provider key (xAI, Anthropic, or OpenAI) and optionally a bot token for messaging channels."}),e.jsxs(n,{size:"sm",className:"mt-4",onClick:()=>S(!0),children:[e.jsx(P,{className:"mr-2 h-4 w-4"})," Add Your First Credential"]})]})})]}),e.jsx(O,{open:Y,onOpenChange:y,children:e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx($,{children:"Rotate Secret"}),e.jsxs(K,{children:["Enter a new value for ",e.jsx("span",{className:"font-mono",children:o==null?void 0:o.key})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"New Secret Value"}),e.jsx(H,{value:f,onChange:C,placeholder:"Enter new secret value"})]})}),e.jsxs(z,{children:[e.jsx(n,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(n,{onClick:B,disabled:!f,children:"Rotate"})]})]})}),e.jsx(xe,{open:!!d,onOpenChange:t=>{t||V(null)},title:"Delete Credential",description:`Permanently delete "${(d==null?void 0:d.key)??""}"? The secret value cannot be recovered.`,confirmLabel:"Delete",destructive:!0,onConfirm:async()=>{if(!d)return;const t=d;try{await j(t.key),w()!=="web"&&await b().catch(()=>{}),k(`Deleted ${t.key}`,"success")}catch(m){k(`Failed to delete: ${m instanceof Error?m.message:String(m)}`,"error")}}})]})}export{Ve as default};
