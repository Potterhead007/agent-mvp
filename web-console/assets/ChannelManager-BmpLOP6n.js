const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TelegramSetup-BhHXh9sl.js","assets/index-DLzrVyEL.js","assets/index-Di2Zhpwl.css","assets/label-N6WvVUTh.js","assets/SecureInput-BOCeOhgm.js","assets/eye-D6E-mqI1.js","assets/config-DtO68tKR.js","assets/SlackSetup-ek3MYwrN.js","assets/DiscordSetup-B1ihDJlI.js"])))=>i.map(i=>d[i]);
import{c as D,j as e,C as P,a as O,b as q,e as z,l as _,L as A,B as k,W as B,r as i,u as L,i as C,d as H,R as I,v as $,a3 as w,g as V,M as U,k as F,a4 as N,a5 as b,a6 as G,_ as E}from"./index-DLzrVyEL.js";import{u as W}from"./useConfig-DHY6Oysh.js";import{w as J}from"./config-DtO68tKR.js";import{S as K}from"./switch-CtqUxp-4.js";import{H as Q}from"./HelpTip-Bf0ngYP4.js";import{u as X}from"./usePageTitle-BWQ1x_eW.js";import"./index-C-bnBz93.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=D("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=D("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=D("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function se({type:t,name:h,icon:l,description:d,enabled:o,pendingSetup:p,liveStatus:u,probing:m,onToggle:g,onConfigure:v}){return e.jsxs(P,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(l,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(q,{className:"text-base",children:h}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d})]})]}),e.jsx(K,{checked:o,onCheckedChange:g})]}),e.jsxs(z,{children:[!o&&p&&e.jsx("p",{className:"mb-3 text-xs text-amber-500",children:"Selected during onboarding — click Configure to add your bot token and enable."}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:o?"success":"outline",children:o?"Enabled":"Disabled"}),o&&m&&e.jsx(A,{className:"h-3 w-3 animate-spin text-muted-foreground"}),o&&!m&&u&&e.jsx(_,{variant:u.connected?"success":"destructive",children:u.connected?"Connected":"Disconnected"}),o&&!m&&(u==null?void 0:u.lastError)&&e.jsx("span",{className:"text-xs text-destructive max-w-[200px] truncate",title:u.lastError,children:u.lastError})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:v,children:[e.jsx(B,{className:"mr-2 h-4 w-4"})," Configure"]})]})]})]})}function te({enabledChannels:t}){const[h,l]=i.useState({}),[d,o]=i.useState(!1),[p,u]=i.useState(null),m=L(n=>n.gatewayConnected),g=i.useCallback(async()=>{if(!(!m||t.length===0)){o(!0);try{const n={};for(const c of t)try{const a=await C("list_pairing_requests",{channel:c});a.length>0&&(n[c]=a)}catch{}l(n)}finally{o(!1)}}},[m,t]);i.useEffect(()=>{if(!m||t.length===0)return;g();const n=setInterval(g,2e4);return()=>clearInterval(n)},[m,t,g]);const v=async(n,c)=>{var a;u(c);try{await C("approve_pairing_request",{channel:n,code:c});const s=(h[n]??[]).find(r=>r.code===c);s&&C("record_usage",{channel:n,userId:s.id,displayName:((a=s.meta)==null?void 0:a.displayName)??null}).catch(()=>{}),w(`Approved pairing for ${n}`,"success"),l(r=>{const x={...r};return x[n]=(x[n]??[]).filter(f=>f.code!==c),x[n].length===0&&delete x[n],x})}catch(s){w(`Failed to approve: ${String(s)}`,"error")}finally{u(null)}},y=Object.values(h).reduce((n,c)=>n+c.length,0);return e.jsxs(P,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-amber-500/10",children:e.jsx(Z,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx(q,{className:"text-base",children:"Pairing Requests"}),e.jsx(H,{className:"text-xs",children:"Approve users to interact with your bot"})]})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:g,disabled:d||!m||t.length===0,children:[e.jsx(I,{className:`mr-2 h-4 w-4 ${d?"animate-spin":""}`}),"Refresh"]})]}),e.jsx(z,{children:m?t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable a channel above to receive pairing requests."}):y===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:d?"Checking for pending requests...":"No pending pairing requests."}):e.jsx("div",{className:"space-y-3",children:Object.entries(h).map(([n,c])=>c.map(a=>e.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(ee,{className:"h-4 w-4 shrink-0 text-muted-foreground"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:"outline",className:"capitalize text-xs",children:n}),e.jsx("span",{className:"font-mono text-sm font-medium",children:a.code})]}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["User ID: ",a.id,a.createdAt&&e.jsxs(e.Fragment,{children:[" · ",new Date(a.createdAt).toLocaleTimeString()]})]})]})]}),e.jsxs(k,{size:"sm",onClick:()=>v(n,a.code),disabled:p!==null,children:[p===a.code?e.jsx(A,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}):e.jsx($,{className:"mr-1.5 h-3.5 w-3.5"}),"Approve"]})]},`${n}-${a.code}`)))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start agents to check for pairing requests."})})]})}const ne=i.lazy(()=>E(()=>import("./TelegramSetup-BhHXh9sl.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>({default:t.TelegramSetup}))),ae=i.lazy(()=>E(()=>import("./SlackSetup-ek3MYwrN.js"),__vite__mapDeps([7,1,2,3,4,5,6])).then(t=>({default:t.SlackSetup}))),re=i.lazy(()=>E(()=>import("./DiscordSetup-B1ihDJlI.js"),__vite__mapDeps([8,1,2,3,4,5,6])).then(t=>({default:t.DiscordSetup})));function S(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(A,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}const R=[{type:"telegram",name:"Telegram",icon:U,description:"Chat with your agent via Telegram"},{type:"slack",name:"Slack",icon:Y,description:"Add your agent to a Slack workspace"},{type:"discord",name:"Discord",icon:F,description:"Bring your agent into a Discord server"}];function xe(){var a;X("Channels");const{config:t,reload:h}=W(),l=(a=t==null?void 0:t.settings)==null?void 0:a.channels,d=L(s=>s.gatewayConnected),[o,p]=i.useState(null),[u,m]=i.useState({}),[g,v]=i.useState(!1),y=i.useCallback(async(s=!1)=>{if(d){v(!0);try{const r=await V.requestAsync("channels.status",{probe:!0},5e3),x=(r==null?void 0:r.channels)??r,f={};for(const[M,j]of Object.entries(x))if(j&&typeof j=="object"){const T=!!j.running;f[M]={connected:"connected"in j?!!j.connected:T,running:T,lastError:j.lastError??null,reconnectAttempts:j.reconnectAttempts??0}}m(f)}catch{s&&w("Could not check channel status. Make sure your agents are running.","warning")}finally{v(!1)}}},[d]);i.useEffect(()=>{d&&y()},[d,y]);const n=async(s,r)=>{if(!t)return;const x={...t,settings:{...t.settings,channels:{...t.settings.channels,[s]:{...t.settings.channels[s]??{},enabled:r}}}};if(await J(x),await h(),d){try{await G(),await new Promise(f=>setTimeout(f,1500))}catch{w("Could not apply configuration to running agents","warning")}setTimeout(y,2e3)}},c=()=>{p(null),h(),setTimeout(y,5e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:["Channels",e.jsx(Q,{text:"Channels let your agent talk on Telegram, Slack, or Discord. Set up a bot token for each platform, then toggle it on."})]}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your agent to messaging platforms"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>y(!0),disabled:g||!d,"aria-label":"Refresh channel status",children:[e.jsx(I,{className:`mr-2 h-4 w-4 ${g?"animate-spin":""}`}),d?"Refresh Status":"Agents Offline"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:R.map(s=>{var r,x;return e.jsx(se,{type:s.type,name:s.name,icon:s.icon,description:s.description,enabled:((r=l==null?void 0:l[s.type])==null?void 0:r.enabled)??!1,pendingSetup:((x=l==null?void 0:l[s.type])==null?void 0:x.pendingSetup)===!0,liveStatus:u[s.type]??null,probing:g,onToggle:f=>n(s.type,f),onConfigure:()=>p(s.type)},s.type)})}),e.jsx(te,{enabledChannels:R.filter(s=>{var r;return(r=l==null?void 0:l[s.type])==null?void 0:r.enabled}).map(s=>s.type)}),e.jsx(N,{open:o==="telegram",onOpenChange:s=>!s&&p(null),children:e.jsx(b,{children:e.jsx(i.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(ne,{onSaved:c})})})}),e.jsx(N,{open:o==="slack",onOpenChange:s=>!s&&p(null),children:e.jsx(b,{children:e.jsx(i.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(ae,{onSaved:c})})})}),e.jsx(N,{open:o==="discord",onOpenChange:s=>!s&&p(null),children:e.jsx(b,{children:e.jsx(i.Suspense,{fallback:e.jsx(S,{}),children:e.jsx(re,{onSaved:c})})})})]})}export{xe as default};
