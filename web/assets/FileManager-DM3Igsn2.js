import{c as ae,r as t,i as u,a3 as C,j as e,C as M,a as O,b as R,B as d,$ as te,R as B,e as H,z as re,N as I,Y as le,a4 as ne,a5 as ie,a7 as ce,a8 as oe,a9 as de,a0 as me,aa as xe,a1 as he}from"./index-DMLsphgf.js";import{T as fe}from"./textarea-CjM46Vzf.js";import{T as ue,a as pe,b as K,c as q}from"./tabs-D0SXjfep.js";import{w as U,r as ge}from"./filesystem-VmxbBCrt.js";import{S as x}from"./skeleton-giArBBxK.js";import{H as je}from"./HelpTip-C9GnilBF.js";import{u as we}from"./usePageTitle-CuOKjwOe.js";import{S as ve}from"./save-BadSKbn8.js";import{T as Ne}from"./trash-2-DsaYNtF4.js";import"./index-CbU4h7md.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=ae("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);function _e(){we("Files");const[S,D]=t.useState([]),[l,F]=t.useState(null),[n,p]=t.useState(""),[Z,h]=t.useState(""),[b,T]=t.useState(!1),[W,E]=t.useState(!1),[X,v]=t.useState(!1),[g,$]=t.useState(""),[_,i]=t.useState(null),[N,j]=t.useState(!1),[Y,z]=t.useState(null),c=t.useCallback(async()=>{try{const s=await u("list_workspace_tree");D(s),z(null)}catch(s){D([]),z(s instanceof Error?s.message:String(s))}},[]);t.useEffect(()=>{c()},[c]);const[P,y]=t.useState(null),w=async s=>{F(s),E(!0),y(null);try{const a=await ge(s);p(a),h(a)}catch(a){p(""),h(""),y(a instanceof Error?a.message:String(a))}finally{E(!1)}},k=t.useCallback(async()=>{if(l){T(!0),i(null);try{await U(l,n),h(n)}catch(s){i(`Failed to save: ${String(s)}`)}finally{T(!1)}}},[l,n]),L=async()=>{if(!g.trim())return;i(null);const s=g.trim();try{await u("create_workspace_file",{relativePath:s,content:""}),v(!1),$(""),await c(),w(s)}catch(a){i(`Failed to create file: ${String(a)}`)}},G=async()=>{if(!l)return;i(null);const s=l,a=n;try{await u("delete_workspace_file",{relativePath:s}),F(null),p(""),h(""),await c(),he(`Deleted ${s}`,async()=>{try{await u("create_workspace_file",{relativePath:s,content:a}),await c(),w(s)}catch{C("Failed to restore file","error")}})}catch(r){i(`Failed to delete file: ${String(r)}`)}},J=10*1024*1024,Q=async s=>{s.preventDefault(),j(!1);const a=s.dataTransfer.files;for(let r=0;r<a.length;r++){const o=a[r];if(o.size>J){C(`"${o.name}" is too large (${(o.size/1024/1024).toFixed(1)} MB). Max 10 MB.`,"error");continue}try{const se=await o.text();await u("create_workspace_file",{relativePath:o.name,content:se})}catch{i(`Failed to upload: ${o.name}`)}}await c()},m=n!==Z,f=t.useRef(null);t.useEffect(()=>{if(!(!l||!m))return f.current&&clearTimeout(f.current),f.current=setTimeout(async()=>{try{await U(l,n),h(n)}catch(s){C(`Auto-save failed: ${s instanceof Error?s.message:String(s)}`,"error")}},1500),()=>{f.current&&clearTimeout(f.current)}},[n,l,m]),t.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="s"&&(a.preventDefault(),l&&m&&k())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[l,m,k]);const ee=(s,a)=>{(s.key==="Enter"||s.key===" ")&&a.type==="file"&&(s.preventDefault(),w(a.path))},A=(s,a=0)=>e.jsx("div",{style:{paddingLeft:a*16},children:s.map(r=>e.jsxs("div",{children:[e.jsxs("div",{role:"button",tabIndex:0,className:`flex items-center gap-2 rounded px-2 py-1 text-sm cursor-pointer hover:bg-accent ${l===r.path?"bg-accent":""}`,onClick:()=>r.type==="file"&&w(r.path),onKeyDown:o=>ee(o,r),children:[r.type==="directory"?e.jsx(I,{className:"h-4 w-4 text-primary shrink-0"}):e.jsx(V,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"truncate",children:r.name})]}),r.children&&A(r.children,a+1)]},r.path))});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:["Files",e.jsx(je,{text:"Browse and edit agent workspace files. Create, rename, or delete files directly. Changes are saved automatically."})]}),e.jsx("p",{className:"text-muted-foreground",children:"Agent workspace file manager"})]}),e.jsxs("div",{className:"flex h-[calc(100vh-12rem)] gap-4",children:[e.jsxs(M,{className:`hidden md:flex w-64 shrink-0 flex-col ${N?"ring-2 ring-primary":""}`,onDragOver:s=>{s.preventDefault(),j(!0)},onDragEnter:s=>{s.preventDefault(),j(!0)},onDragLeave:()=>j(!1),onDrop:Q,children:[e.jsxs(O,{className:"flex-row items-center justify-between py-3",children:[e.jsx(R,{className:"text-sm",children:"Workspace"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"New file",onClick:()=>v(!0),children:e.jsx(te,{className:"h-3.5 w-3.5"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8","aria-label":"Refresh file tree",onClick:c,children:e.jsx(B,{className:"h-3.5 w-3.5"})})]})]}),e.jsx(H,{className:"flex-1 p-2 overflow-hidden",children:e.jsx(re,{className:"h-full",children:Y?e.jsxs("div",{className:"text-xs text-destructive text-center py-4",children:[e.jsx("p",{children:"Failed to load files"}),e.jsxs(d,{variant:"ghost",size:"sm",className:"mt-1",onClick:c,children:[e.jsx(B,{className:"mr-1 h-3 w-3"})," Retry"]})]}):S.length>0?A(S):e.jsx("div",{className:`text-center py-4 rounded-md transition-colors ${N?"bg-primary/5":""}`,children:N?e.jsx("p",{className:"text-xs text-primary font-medium",children:"Drop files to upload"}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-8 w-8 text-muted-foreground/40 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground font-medium",children:"Empty workspace"}),e.jsx("p",{className:"text-[10px] text-muted-foreground/60 mt-1",children:"Drag files here or click + to create"})]})})})})]}),e.jsxs(M,{className:"flex-1 flex flex-col",children:[e.jsxs(O,{className:"flex-row items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"text-sm font-mono",children:l??"No file selected"}),m&&e.jsx("span",{className:"text-xs text-yellow-400",children:"(saving...)"}),b&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(saving...)"})]}),l&&e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(d,{onClick:k,disabled:b||!m,size:"sm",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Save"]}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-9 w-9 text-destructive","aria-label":"Delete file",onClick:G,children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsxs(H,{className:"flex-1 p-0 overflow-hidden",children:[(_||P)&&e.jsxs("div",{className:"mx-4 mt-2 flex items-center gap-2 rounded-md border border-destructive/20 bg-destructive/10 px-3 py-2 text-sm text-destructive",children:[e.jsx(le,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"flex-1",children:_??`Failed to read file: ${P}`}),e.jsx(d,{variant:"ghost",size:"sm",className:"shrink-0 h-6 px-2 text-xs",onClick:()=>{i(null),y(null)},children:"Dismiss"})]}),W?e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx(x,{className:"h-4 w-full"}),e.jsx(x,{className:"h-4 w-3/4"}),e.jsx(x,{className:"h-4 w-5/6"}),e.jsx(x,{className:"h-4 w-2/3"}),e.jsx(x,{className:"h-4 w-full"}),e.jsx(x,{className:"h-4 w-4/5"})]}):l?e.jsxs(ue,{defaultValue:"edit",className:"h-full flex flex-col",children:[e.jsxs(pe,{className:"mx-4",children:[e.jsx(K,{value:"edit",children:"Edit"}),e.jsx(K,{value:"preview",children:"Preview"})]}),e.jsx(q,{value:"edit",className:"flex-1 px-4 pb-4",children:e.jsx(fe,{value:n,onChange:s=>p(s.target.value),className:"h-full min-h-0 font-mono text-sm resize-none"})}),e.jsx(q,{value:"preview",className:"flex-1 px-4 pb-4",children:e.jsx("div",{className:"h-full overflow-auto rounded-md border p-4",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:n})})})]}):e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(V,{className:"h-10 w-10 text-muted-foreground/30"}),e.jsx("p",{className:"font-medium",children:"Select a file to edit"}),e.jsx("p",{className:"text-sm text-muted-foreground/60",children:"Choose a file from the workspace tree, or create a new one"})]})]})]}),e.jsx(ne,{open:X,onOpenChange:v,children:e.jsxs(ie,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Create New File"}),e.jsx(de,{children:"Enter the path relative to the config directory"})]}),e.jsx(me,{value:g,onChange:s=>$(s.target.value),placeholder:"e.g., agents/myagent/SOUL.md",onKeyDown:s=>s.key==="Enter"&&L()}),e.jsx(xe,{children:e.jsx(d,{onClick:L,disabled:!g.trim(),children:"Create"})})]})})]})]})}export{_e as default};
