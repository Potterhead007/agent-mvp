import{c as Be,ab as Me,u as $e,r as o,D as V,F as Ge,h as We,k as Ye,i as f,j as e,C as Ue,a as qe,b as He,d as Ve,e as ze,B as K,R as ge,L as fe,m as Xe,ae as W,aj as Y,aO as Je,aS as Qe,aT as Ze,p as et,l as A,M as tt,a0 as st,V as at,v as B,K as nt,Y as ye,w as U}from"./index-DMLsphgf.js";import{L as N}from"./label-C04T9kgc.js";import{T as it}from"./textarea-CjM46Vzf.js";import{S as rt}from"./switch-BR8PlpcT.js";import{P as lt}from"./progress-CxfYkmZE.js";import{S as ve}from"./SecureInput-g-y9d4Mj.js";import{u as ot}from"./usePageTitle-CuOKjwOe.js";import{o as je}from"./ExternalLink-DShwraXM.js";import{w as me}from"./filesystem-VmxbBCrt.js";import{r as pe,w as xe}from"./config-CjXRnFJJ.js";import{g as ct,M as dt}from"./models-BN2rvPIS.js";import{H as mt}from"./HelpTip-C9GnilBF.js";import{C as Ne}from"./check-B844v-9Y.js";import{A as pt}from"./arrow-left-Pa98Ocwk.js";import{E as xt}from"./external-link-BkKpxokb.js";import"./index-DdraVgRc.js";import"./eye-xZN8o4kq.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=Be("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),q=[{value:"ollama",label:"Ollama",description:"Local open-source models",pricing:"Completely free. Runs on your computer.",badge:"Free — No API key needed"},{value:"anthropic",label:"Anthropic",description:"Claude models (Opus, Sonnet, Haiku)",pricing:"Pay-as-you-go. Typical cost: ~$0.01–0.05 per message.",badge:"Requires API key ($)",apiKeyUrl:"https://console.anthropic.com/settings/keys",apiKeyPlaceholder:"sk-ant-...",steps:[{action:"Go to console.anthropic.com",detail:"Sign in or create a free account"},{action:"Open Settings → API Keys",detail:"Navigate to your account settings"},{action:"Create a new key",detail:"Click Create Key and give it a name"},{action:"Copy and paste below",detail:"The key starts with sk-ant-"}]},{value:"xai",label:"xAI",description:"Grok models",pricing:"Pay-as-you-go. Typical cost: ~$0.01–0.05 per message.",badge:"Requires API key ($)",apiKeyUrl:"https://console.x.ai/team/default/api-keys",apiKeyPlaceholder:"xai-...",steps:[{action:"Go to console.x.ai",detail:"Sign in with your X / xAI account"},{action:"Open API Keys",detail:"Navigate to the API Keys section"},{action:"Create a new key",detail:"Click Create API Key"},{action:"Copy and paste below",detail:"The key starts with xai-"}]},{value:"openai",label:"OpenAI",description:"GPT & o-series models",pricing:"Pay-as-you-go. Typical cost: ~$0.01–0.05 per message.",badge:"Requires API key ($)",apiKeyUrl:"https://platform.openai.com/api-keys",apiKeyPlaceholder:"sk-...",steps:[{action:"Go to platform.openai.com",detail:"Sign in or create an account"},{action:"Open API Keys page",detail:"Click your profile → API Keys"},{action:"Create new secret key",detail:"Click Create new secret key and name it"},{action:"Copy and paste below",detail:"The key starts with sk-"}]}],M=[{key:"telegram",label:"Telegram",description:"Chat with your agent via Telegram bot",vaultKey:"TELEGRAM_BOT_TOKEN",tokenPlaceholder:"123456789:ABCdefGHI...",tokenFormat:"Format: 123456789:ABCdefGHI...",steps:[{action:"Open Telegram",detail:"Search for @BotFather and start a chat"},{action:"Create a bot",detail:"Send /newbot and follow the prompts to name it"},{action:"Copy the token",detail:"BotFather will reply with your Bot Token"},{action:"Paste below",detail:"Or skip and add it later on the Channels page"}]},{key:"slack",label:"Slack",description:"Add your agent to Slack workspaces",vaultKey:"SLACK_BOT_TOKEN",tokenPlaceholder:"xoxb-...",tokenFormat:"Bot Token starts with xoxb-",steps:[{action:"Go to api.slack.com/apps",detail:"Sign in and click Create New App"},{action:"Choose From Scratch",detail:"Name it and select your workspace"},{action:"Add Bot Scopes",detail:"Under OAuth → Scopes, add chat:write and app_mentions:read"},{action:"Install to Workspace",detail:"Click Install App and authorize"},{action:"Copy Bot Token",detail:"Copy the xoxb-... token and paste below"}]},{key:"discord",label:"Discord",description:"Deploy your agent to Discord servers",vaultKey:"DISCORD_BOT_TOKEN",tokenPlaceholder:"MTIz...",tokenFormat:"Token from Bot settings page",steps:[{action:"Go to discord.com/developers",detail:"Sign in and click New Application"},{action:"Create a Bot",detail:"Go to Bot tab and click Add Bot"},{action:"Enable Intents",detail:"Turn on Message Content Intent under Privileged Intents"},{action:"Copy the token",detail:"Click Reset Token, then copy it"},{action:"Invite to server",detail:"Go to OAuth2 → URL Generator, select bot scope, and open the invite link"}]}],ue={xai:"grok-4-1-fast-reasoning",anthropic:"claude-sonnet-4-20250514",openai:"gpt-4o",ollama:"llama3"},ut={anthropic:{prefix:"sk-ant-",label:"Anthropic keys start with sk-ant-"},openai:{prefix:"sk-",label:"OpenAI keys start with sk-"},xai:{prefix:"xai-",label:"xAI keys start with xai-"}},H=[{id:"general",label:"General Assistant",description:"Versatile helper for everyday tasks",content:`# Agent Personality

You are a helpful, knowledgeable assistant.

## Tone
- Friendly and professional
- Concise but thorough

## Behaviour
- Always cite sources when possible
- Ask clarifying questions when the request is ambiguous
- Respect user privacy
`},{id:"coder",label:"Code Expert",description:"Focused on programming and development",content:`# Code Expert

You are a senior software engineer and coding assistant.

## Tone
- Technical and precise
- Direct — no filler or fluff

## Behaviour
- Write clean, production-ready code with no shortcuts
- Explain your reasoning for architectural decisions
- Suggest tests alongside implementations
- Flag security issues proactively
- Prefer standard libraries over adding dependencies
`},{id:"researcher",label:"Research Analyst",description:"Deep analysis and fact-finding",content:`# Research Analyst

You are a meticulous research analyst with expertise in synthesizing complex information.

## Tone
- Analytical and evidence-based
- Balanced — present multiple perspectives

## Behaviour
- Structure findings with clear sections and summaries
- Distinguish facts from opinions and estimates
- Cite sources and note confidence levels
- Identify knowledge gaps and suggest follow-up questions
- Present data in tables when it aids comparison
`},{id:"creative",label:"Creative Writer",description:"Content creation and storytelling",content:`# Creative Writer

You are a versatile creative writer with a strong voice and attention to craft.

## Tone
- Engaging and vivid
- Adaptable to the user's requested style

## Behaviour
- Use concrete sensory details over abstract descriptions
- Vary sentence structure and rhythm
- Respect the user's creative vision — enhance, don't override
- Offer multiple variations when asked for ideas
- Keep drafts tightly edited — every word should earn its place
`}],he=[{id:"docker",title:"Setup Check",icon:V,description:"Making sure everything is ready"},{id:"model",title:"Provider & Model",icon:Ge,description:"Select your AI provider, model, and API key"},{id:"personality",title:"Agent Setup",icon:We,description:"Name and personalise your first agent"},{id:"channels",title:"Channels",icon:Ye,description:"Connect messaging platforms"},{id:"review",title:"Review",icon:Ne,description:"Confirm and launch"}];function ht(t,c){if(t==="ollama")return null;if(!c.trim())return"API key is required for this provider";const r=ut[t];return r&&!c.startsWith(r.prefix)?r.label:c.trim().length<10?"API key seems too short":null}function gt({dockerCheck:t,checking:c,onRecheck:r}){if(c||!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 py-8",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Checking system requirements..."})]});const m=t.dockerInstalled&&t.composeInstalled&&t.dockerRunning;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-sm font-medium",children:"System Requirements"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Agentic Console needs a small background app to run your agents locally."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[t.dockerInstalled?e.jsx(B,{className:"h-4 w-4 text-green-500 shrink-0"}):e.jsx(U,{className:"h-4 w-4 text-destructive shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Agent Engine"}),t.dockerVersion&&e.jsxs("p",{className:"text-xs text-muted-foreground leading-tight",children:["v",t.dockerVersion.replace(/^Docker version\s*/i,"").split(",")[0]]})]})]}),e.jsx(A,{variant:t.dockerInstalled?"secondary":"destructive",children:t.dockerInstalled?"Installed":"Not Found"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[t.composeInstalled?e.jsx(B,{className:"h-4 w-4 text-green-500 shrink-0"}):e.jsx(U,{className:"h-4 w-4 text-destructive shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Agent Toolkit"}),t.composeVersion&&e.jsx("p",{className:"text-xs text-muted-foreground leading-tight",children:t.composeVersion})]})]}),e.jsx(A,{variant:t.composeInstalled?"secondary":"destructive",children:t.composeInstalled?"Installed":"Not Found"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[t.dockerRunning?e.jsx(B,{className:"h-4 w-4 text-green-500 shrink-0"}):e.jsx(U,{className:"h-4 w-4 text-destructive shrink-0"}),e.jsx("span",{className:"font-medium text-sm",children:"Ready to Run"})]}),e.jsx(A,{variant:t.dockerRunning?"secondary":"destructive",children:t.dockerRunning?"Running":"Stopped"})]})]}),!t.dockerInstalled&&e.jsxs("div",{className:"rounded-lg border border-destructive/30 bg-destructive/5 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:"Additional setup needed"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Your agents need a background app to operate. Install the free Docker Desktop app (it runs quietly in the background), then click “Re-check” below."}),e.jsxs(K,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>je("https://docker.com/products/docker-desktop"),children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Download Docker Desktop"]})]}),t.dockerInstalled&&!t.dockerRunning&&e.jsxs("div",{className:"rounded-lg border border-yellow-500/30 bg-yellow-500/5 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-yellow-500"}),e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Agent Engine is not running"})]}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Open Docker Desktop from your Applications folder and wait for it to start, then click “Re-check”."})]}),!m&&e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsxs(K,{variant:"outline",onClick:r,disabled:c,children:[e.jsx(ge,{className:`mr-2 h-4 w-4 ${c?"animate-spin":""}`})," Re-check"]})})]})}function ft({provider:t,model:c,apiKey:r,apiKeyWarning:m,onSelectProvider:h,onSelectModel:p,onApiKeyChange:n}){const[i,b]=o.useState(!1),y=dt.filter(s=>s.provider===t),x=q.find(s=>s.value===t),S=t!=="ollama";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Provider"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:q.map(s=>{const v=t===s.value;return e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>{h(s.value),b(!1)},onKeyDown:$=>$.key==="Enter"&&h(s.value),className:`flex flex-col items-start gap-0.5 rounded-lg border-2 px-3 py-2 text-left transition-colors cursor-pointer ${v?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/40"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:s.label}),s.badge&&e.jsx(A,{variant:s.value==="ollama"?"success":"outline",className:"text-[10px] px-1.5 py-0",children:s.value==="ollama"?"Free":"$"})]}),e.jsx("span",{className:"text-xs text-muted-foreground leading-tight",children:s.description}),e.jsx("span",{className:"text-[10px] text-muted-foreground/70 leading-tight",children:s.pricing})]},s.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Model"}),e.jsx("div",{className:"space-y-1.5",children:y.map(s=>{const v=c===s.value;return e.jsxs("button",{type:"button",onClick:()=>p(s.value),className:`flex w-full items-center justify-between rounded-lg border-2 px-3 py-2 text-left transition-colors ${v?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/40"}`,children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-medium text-sm",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground leading-tight",children:s.description})]}),v&&e.jsx(B,{className:"h-5 w-5 text-primary shrink-0 ml-2"})]},s.value)})})]}),S&&x&&e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border px-3 py-3 space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(N,{className:"text-sm font-medium flex items-center gap-1.5",children:[x.label," API Key ",e.jsx(mt,{text:"An API key is like a password that lets your agent talk to the AI service. You create one on the provider's website, and it stays encrypted on your computer."})]})]}),r.trim()&&!m?e.jsx(A,{variant:"success",className:"text-[10px] px-1.5 py-0",children:"Ready"}):e.jsx("span",{className:"text-[10px] text-muted-foreground/60",children:"Required"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{type:"button",onClick:()=>b(!i),className:"flex items-center gap-1.5 text-xs text-primary hover:text-primary/80 transition-colors",children:[e.jsx(z,{className:`h-3 w-3 transition-transform ${i?"rotate-90":""}`}),i?"Hide guide":`How to get your ${x.label} key`]}),x.apiKeyUrl&&e.jsxs("button",{type:"button",onClick:()=>je(x.apiKeyUrl),className:"flex items-center gap-1.5 rounded-md bg-primary/10 px-2.5 py-1 text-xs font-medium text-primary hover:bg-primary/20 transition-colors",children:["Open ",x.label,e.jsx(xt,{className:"h-3 w-3"})]})]}),i&&x.steps&&e.jsx("div",{className:"rounded-md bg-muted/50 px-3 py-2 space-y-1.5",children:x.steps.map((s,v)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-primary/10 text-[10px] font-bold text-primary",children:v+1}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-medium",children:s.action}),e.jsx("p",{className:"text-[11px] text-muted-foreground leading-tight",children:s.detail})]})]},v))}),e.jsx(ve,{value:r,onChange:n,placeholder:x.apiKeyPlaceholder??"sk-..."}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-yellow-500",children:[e.jsx(ye,{className:"h-3.5 w-3.5 shrink-0"}),e.jsx("span",{children:m})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground/60",children:"Stored locally in an encrypted vault. Never leaves your machine."})]})]})}function yt({agentName:t,soulMd:c,activeTemplate:r,onNameChange:m,onSoulChange:h,onSelectTemplate:p}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(N,{htmlFor:"agent-name",className:"text-sm font-medium",children:"Agent Name"}),e.jsx(st,{id:"agent-name",value:t,onChange:n=>m(n.target.value),placeholder:"e.g. Atlas, Nova, Jarvis..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Personality Template"}),e.jsx(at,{className:"h-4 w-4 text-primary"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1.5",children:H.map(n=>{const i=r===n.id;return e.jsxs("button",{type:"button",onClick:()=>p(n.id),className:`flex flex-col items-start gap-0.5 rounded-lg border-2 px-3 py-2 text-left transition-colors ${i?"border-primary bg-primary/5":"border-border hover:border-muted-foreground/40"}`,children:[e.jsx("span",{className:"font-medium text-sm",children:n.label}),e.jsx("span",{className:"text-xs text-muted-foreground leading-tight",children:n.description})]},n.id)})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{htmlFor:"soul-md",className:"text-sm font-medium text-muted-foreground",children:"SOUL.md"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[c.length," chars"]})]}),e.jsx(it,{id:"soul-md",value:c,onChange:n=>h(n.target.value),className:"min-h-[100px] font-mono text-xs",placeholder:"Write your agent's personality..."})]})]})}function vt({channels:t,channelTokens:c,onToggle:r,onTokenChange:m}){const[h,p]=o.useState(null);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-sm font-medium",children:"Connect Channels"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Enable a platform and optionally enter the bot token now, or set it up later on the Channels page."})]}),e.jsx("div",{className:"space-y-2",children:M.map(n=>{const i=t[n.key],b=c[n.key],y=h===n.key;return e.jsxs("div",{className:`rounded-lg border-2 transition-colors ${i?"border-primary/30 bg-primary/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx(tt,{className:`h-4 w-4 shrink-0 ${i?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-medium text-sm",children:n.label}),e.jsx("p",{className:"text-xs text-muted-foreground leading-tight",children:n.description})]})]}),e.jsx(rt,{checked:i,onCheckedChange:()=>r(n.key),className:"shrink-0 ml-2"})]}),i&&e.jsxs("div",{className:"border-t border-border/50 px-3 py-2.5 space-y-2.5",children:[e.jsxs("button",{type:"button",onClick:()=>p(y?null:n.key),className:"flex items-center gap-1.5 text-xs text-primary hover:text-primary/80 transition-colors",children:[e.jsx(z,{className:`h-3 w-3 transition-transform ${y?"rotate-90":""}`}),y?"Hide setup guide":`How to get a ${n.label} bot token`]}),y&&e.jsx("div",{className:"rounded-md bg-muted/50 px-3 py-2 space-y-1.5",children:n.steps.map((x,S)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-primary/10 text-[10px] font-bold text-primary",children:S+1}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-xs font-medium",children:x.action}),e.jsx("p",{className:"text-[11px] text-muted-foreground leading-tight",children:x.detail})]})]},S))}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{className:"text-xs text-muted-foreground",children:"Bot Token"}),b?e.jsx(A,{variant:"success",className:"text-[10px] px-1.5 py-0",children:"Ready"}):e.jsx("span",{className:"text-[10px] text-muted-foreground/60",children:"Optional — add later"})]}),e.jsx(ve,{value:b,onChange:x=>m(n.key,x),placeholder:n.tokenPlaceholder}),e.jsx("p",{className:"text-[10px] text-muted-foreground/60",children:n.tokenFormat})]})]})]},n.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground/70",children:"Channels won't go live until tokens are configured. You can always add or change them later."})]})}function jt({data:t}){var h;const c=((h=q.find(p=>p.value===t.provider))==null?void 0:h.label)??t.provider,r=ct(t.model),m=M.filter(p=>t.channels[p.key]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-sm font-medium",children:"Review Your Configuration"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:["Everything looks good? Click ",e.jsx("span",{className:"font-semibold",children:"Finish Setup"})," to create your agent and start the engine."]})]}),e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Model"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"outline",children:c}),e.jsx("span",{className:"font-medium text-sm",children:r})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"API Key"}),e.jsx("span",{className:"font-mono text-sm",children:t.apiKey?`${t.apiKey.slice(0,6)}${"*".repeat(Math.min(t.apiKey.length-6,16))}`:e.jsx("span",{className:"italic text-muted-foreground",children:t.provider==="ollama"?"not required":"not set"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Agent Name"}),e.jsx("span",{className:"font-semibold",children:t.agentName||"Atlas"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Personality"}),e.jsxs("span",{className:"text-sm",children:[t.soulMd.length," characters"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Channels"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:m.length>0?m.map(p=>{const n=!!t.channelTokens[p.key];return e.jsxs(A,{variant:n?"success":"outline",children:[p.label,n?" ✓":""]},p.key)}):e.jsx("span",{className:"text-sm italic text-muted-foreground",children:"none — add later"})})]})]})]})}function Lt(){ot("Setup");const t=Me(),c=$e(a=>a.setOnboarded),[r,m]=o.useState(0),[h,p]=o.useState(!1),[n,i]=o.useState(""),[b,y]=o.useState(null),[x,S]=o.useState(null),[s,v]=o.useState(null),[$,X]=o.useState(!1),[T,ke]=o.useState("ollama"),[P,J]=o.useState(ue.ollama),[C,Q]=o.useState(""),[G,be]=o.useState("Atlas"),[w,Z]=o.useState(H[0].content),[we,ee]=o.useState("general"),[k,Ae]=o.useState({telegram:!1,slack:!1,discord:!1}),[F,te]=o.useState({telegram:"",slack:"",discord:""}),O=Xe()==="web",se=O?he.filter(a=>a.id!=="docker"):he,d=se[r],L=se.length,Se=(r+1)/L*100,Ce={provider:T,model:P,apiKey:C,agentName:G,soulMd:w,channels:k,channelTokens:F},ae=o.useCallback(async()=>{if(!O){X(!0);try{const a=await f("check_docker_installed");v(a),a.dockerInstalled&&a.composeInstalled&&a.dockerRunning&&m(u=>u===0?1:u)}catch{v({dockerInstalled:!1,composeInstalled:!1,dockerRunning:!1,dockerVersion:null,composeVersion:null})}finally{X(!1)}}},[O]);o.useEffect(()=>{ae()},[]);const Ie=a=>{ke(a),J(ue[a]),Q(""),S(null)},Te=a=>{const u=H.find(R=>R.id===a);u&&(ee(a),Z(u.content))},Pe=a=>{Ae(u=>({...u,[a]:!u[a]})),k[a]&&te(u=>({...u,[a]:""}))},Re=(a,u)=>{te(R=>({...R,[a]:u}))},Ke=a=>{Q(a),S(ht(T,a))},ne=O||(s==null?void 0:s.dockerInstalled)&&(s==null?void 0:s.composeInstalled)&&(s==null?void 0:s.dockerRunning),Oe=()=>{(d==null?void 0:d.id)==="docker"&&!ne||m(a=>Math.min(a+1,L-1))},_e=()=>{m(a=>Math.max(0,a-1))},ie=async()=>{var a,u,R,re,le,oe,ce;p(!0),y(null);try{const _=G.trim()||"Atlas",E=_.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"default",D=`${T.toUpperCase()}_API_KEY`;if(O){C.trim()&&(i("Storing credentials..."),await f("sync_env_secret",{key:D,value:C}));for(const l of M){const g=F[l.key].trim();g&&await f("sync_env_secret",{key:l.vaultKey,value:g})}i("Creating agent..."),await f("create_agent",{id:E,name:_,model:P,personality:w||null}),w.trim()&&await me(`agents/${E}/agent/SOUL.md`,w),i("Writing configuration...");const j=await pe();j.agents.defaults={...j.agents.defaults,model:P},j.settings.channels={...j.settings.channels,telegram:{...(a=j.settings.channels)==null?void 0:a.telegram,enabled:!1,pendingSetup:k.telegram},slack:{...(u=j.settings.channels)==null?void 0:u.slack,enabled:!1,pendingSetup:k.slack},discord:{...(R=j.settings.channels)==null?void 0:R.discord,enabled:!1,pendingSetup:k.discord}},await xe(j),i("Almost ready..."),await new Promise(l=>setTimeout(l,1e3))}else{try{await f("vault_read_secret",{key:"__vault_probe__"})}catch{throw new Error("Vault is locked. Please unlock the vault before finishing setup.")}i("Storing credentials..."),C.trim()&&(await W({key:D,provider:T,createdAt:new Date().toISOString(),lastRotated:null}),await Y(D,C));for(const g of M){const I=F[g.key].trim();I&&(await W({key:g.vaultKey,provider:g.key,createdAt:new Date().toISOString(),lastRotated:null}),await Y(g.vaultKey,I))}i("Preparing agent environment..."),await f("bootstrap_backend"),i("Generating device identity..."),await f("generate_device_identity"),i("Configuring environment...");const j=await f("write_backend_env",{apiKey:C.trim()||"not-set",provider:T});await W({key:"GATEWAY_TOKEN",provider:"system",createdAt:new Date().toISOString(),lastRotated:null}),await Y("GATEWAY_TOKEN",j),i("Creating agent..."),await f("create_agent",{id:E,name:_,model:P,personality:w||null}),w.trim()&&await me(`agents/${E}/agent/SOUL.md`,w),i("Writing configuration...");const l=await pe();l.agents.defaults={...l.agents.defaults,model:P},l.settings.gateway={url:Ze,port:Qe,wsUrl:Je},l.settings.desktop={...l.settings.desktop,dockerComposePath:"~/agent-mvp",healthCheckIntervalMs:((re=l.settings.desktop)==null?void 0:re.healthCheckIntervalMs)??1e4},l.settings.services={...l.settings.services,postgresPort:5433,redisPort:6380},l.settings.channels={...l.settings.channels,telegram:{...(le=l.settings.channels)==null?void 0:le.telegram,enabled:!1,pendingSetup:k.telegram},slack:{...(oe=l.settings.channels)==null?void 0:oe.slack,enabled:!1,pendingSetup:k.slack},discord:{...(ce=l.settings.channels)==null?void 0:ce.discord,enabled:!1,pendingSetup:k.discord}},await xe(l),i("Starting your agents...");try{await f("docker_up"),i("Almost ready...");const g=Date.now()+6e4;let I=!1;for(;Date.now()<g;){await new Promise(de=>setTimeout(de,3e3));try{if((await et()).gateway){I=!0;break}}catch{}}I||i("Agents started (still warming up — this is normal)")}catch(g){f("log_frontend_error",{severity:"warn",message:`Service start failed: ${g}`,component:"OnboardingWizard"}).catch(()=>{}),i('Setup saved! Couldn’t start automatically — go to Dashboard and click "Start Agents"'),await new Promise(I=>setTimeout(I,2e3))}}c(!0),t("/")}catch(_){const D=String(_).replace(/\b(sk-ant-|xai-|sk-)[^\s'",)}\]]{4,}/g,"$1***");y(D),i("")}finally{p(!1)}},Ee=()=>{y(null),ie()},De=()=>{if(!d)return null;switch(d.id){case"docker":return e.jsx(gt,{dockerCheck:s,checking:$,onRecheck:ae});case"model":return e.jsx(ft,{provider:T,model:P,apiKey:C,apiKeyWarning:x,onSelectProvider:Ie,onSelectModel:J,onApiKeyChange:Ke});case"personality":return e.jsx(yt,{agentName:G,soulMd:w,activeTemplate:we,onNameChange:be,onSoulChange:a=>{Z(a),ee("custom")},onSelectTemplate:Te});case"channels":return e.jsx(vt,{channels:k,channelTokens:F,onToggle:Pe,onTokenChange:Re});case"review":return e.jsx(jt,{data:Ce})}},Fe=r===L-1,Le=(d==null?void 0:d.icon)??V;return e.jsx("div",{className:"flex min-h-screen items-start justify-center overflow-y-auto bg-background px-4 py-6",children:e.jsxs(Ue,{className:"flex w-full max-w-2xl flex-col max-h-[calc(100vh-3rem)]",children:[e.jsxs(qe,{className:"shrink-0 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(He,{className:"text-xl sm:text-2xl",children:"Welcome to Agentic Console"}),e.jsx(Ve,{children:"Let's set up your first agent"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap ml-4",children:[r+1," / ",L]})]}),e.jsx(lt,{value:Se,className:"mt-3"})]}),e.jsxs(ze,{className:"flex flex-col gap-4 overflow-y-auto min-h-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border px-3 py-2.5 shrink-0",children:[e.jsx(Le,{className:"h-6 w-6 text-primary shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm",children:d==null?void 0:d.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d==null?void 0:d.description})]})]}),e.jsx("div",{className:"flex-1",children:De()}),b&&e.jsxs("div",{className:"rounded-lg border border-destructive/30 bg-destructive/5 p-3 shrink-0",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:"Setup failed"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground font-mono break-all",children:b}),e.jsxs(K,{variant:"outline",size:"sm",className:"mt-2",onClick:Ee,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Retry"]})]}),h&&n&&e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border p-2.5 shrink-0",children:[e.jsx(fe,{className:"h-4 w-4 animate-spin text-primary shrink-0"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n})]})]}),e.jsxs("div",{className:"flex justify-between border-t px-6 py-4 shrink-0",children:[e.jsxs(K,{variant:"outline",onClick:_e,disabled:r===0||h,children:[e.jsx(pt,{className:"mr-2 h-4 w-4"})," Back"]}),Fe?e.jsx(K,{onClick:ie,disabled:h,children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Setting up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"})," Finish Setup"]})}):e.jsxs(K,{onClick:Oe,disabled:(d==null?void 0:d.id)==="docker"&&!ne,children:["Next ",e.jsx(z,{className:"ml-2 h-4 w-4"})]})]})]})})}export{Lt as default};
